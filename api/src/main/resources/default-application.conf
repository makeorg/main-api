akka {

  actor {
    provider = "akka.cluster.ClusterActorRefProvider"

    serializers {
      make-serializer = "org.make.api.technical.MakeEventSerializer"
    }
    serialization-bindings {
      "org.make.core.MakeSerializable" = make-serializer
    }
  }

  cluster {

    run-coordinated-shutdown-when-down = true

    role {
      seed {
        min-nr-of-members = 1
      }
      worker {
        min-nr-of-members = 1
      }
    }
    roles = ["seed", "worker"]
    seed-nodes = []

    sharding {
      guardian-name = sharding
      remember-entities = false
      state-store-mode = ddata
      role = "worker"
    }
  }

  extensions = [de.heikoseeberger.constructr.ConstructrExtension]

  loggers = ["akka.event.slf4j.Slf4jLogger"]
  loglevel = "DEBUG"
  logging-filter = "akka.event.slf4j.Slf4jLoggingFilter"

  persistence {
    journal {
      plugin = cassandra-journal
    }
    snapshot-store {
      plugin = cassandra-snapshot-store
    }
    role = "worker"
  }

  remote {
    log-remote-lifecycle-events = on
    netty.tcp {
      hostname = "localhost"
      hostname = ${?HOSTNAME}
      hostname = ${?TCP_HOST}
      port = 2551
      port = ${?TCP_PORT}
    }
  }

  http.client.connecting-timeout = "2 seconds"
}

constructr {
  coordination-timeout = "3 seconds"
  join-timeout = "15 seconds"
  max-nr-of-seed-nodes = -1

  coordination {
    nodes = "localhost:12181"
    nodes = ${?ZOOKEEPER_URL}

    zookeeper.rootpath = "/make-api"
    // zookeeper.rootpath = ${?CONTEXT_NAME}
  }
}

kamon {

  # What should be recorder
  util {
    filters {
      "akka.tracked-actor" {
        includes = ["**"]
        excludes = ["*/system/**"]
      }
      "akka.tracked-dispatcher" {
        includes = ["**"]
      }
      "akka.tracked-router" {
        includes = [ "**" ]
      }

      system-metric {
        includes = [ "**" ]
      }

      trace {
        includes = ["**"]
        excludes = []
      }
    }
  }

  prometheus {
    embedded-server {
      # Hostname and port used by the embedded web server to publish the scraping enpoint.
      hostname = localhost
      hostname = ${?HTTP_HOST}
      port = 4000
      port = ${?MONITORING_PORT}
    }
  }

  system-metrics {
    host.enabled = false
    jvm.enabled = true
  }
}

make-api {

  newsletter-url = "https://webflow.com/api/v1/form/59833d390a24e50001b873d8"
  newsletter-url = ${?NEWSLETTER_URL}

  authorized-cors-uri: ["http://localhost:9009", "http://localhost:4242"]
  authorized-cors-uri: ${?AUTHORIZED_CORS_URI}

  default-admin {
    first-name: "admin"
    email: "admin@make.org"
    password: "admin"
  }

  database {
    jdbc-url = "jdbc:postgresql://localhost:26257/makeapi"
    jdbc-url = ${?JDBC_URL}
    user = "root"
    user = ${?DB_USER}
    password = ""
    password = ${?DB_PASSWORD}
    pools {
      read {
        max-total = 50
        initial-size = 10
        max-idle = 10
      }
      write {
        max-total = 50
        initial-size = 10
        max-idle = 10
      }
    }
    auto-create-db-schemas = true
  }

  dev {
    send-test-data = true
  }

  elasticSearch {
    connection-string = "localhost:9200"
    connection-string = ${?ES_URL}
    index-name = "make"
    index-name = ${?ES_INDEX_NAME}
    alias-name = "make_alias"
    alias-name = ${?ES_ALIAS_NAME}
  }

  http {
    host = "0.0.0.0"
    host = ${?HTTP_HOST}
    port = 9000
    port = ${?HTTP_PORT}
    ssl = false
    ssl = ${?SSL}
  }

  kafka {
    connection-string = "localhost:9092"
    connection-string = ${?KAFKA_URI}
    poll-timeout = 10000
    schema-registry = "http://localhost:18081"
    schema-registry = ${?AVRO_REGISTRY_URL}
    topics {
      emails = "emails"
      emails = ${?KAFKA_EMAIL_TOPIC}
      mailjet-events = "mailjet-events"
      mailjet-events = ${?KAFKA_MAILJET_EVENT_TOPIC}
      proposals = "proposals"
      proposals = ${?KAFKA_PROPOSALS_TOPIC}
      users = "users"
      users = ${?KAFKA_USER_TOPIC}
      votes = "votes"
      votes = ${?KAFKA_VOTE_TOPIC}
      duplicates-predicted = "duplicates-predicted"
      duplicates-predicted = ${?KAFKA_DUPLICATE_PREDICTED_TOPIC}
      sequences = "sequences"
      sequences = ${?KAFKA_SEQUENCES_TOPIC}
    }
  }

  mail-jet {
    url = "https://api.mailjet.com/v3.1/send"
    api-key = "e8a39a3f1b830a862dee1cdf8a0db010"
    api-key = ${?MAILJET_API_KEY}
    secret-key = "53029be5adf77aece4e6e381d282d16b"
    secret-key = ${?MAILJET_SECRET_KEY}
    basic-auth-login = "make-mailjet"
    basic-auth-login = ${?MAILJET_AUTH_LOGIN}
    basic-auth-password = "tejliam-ekam"
    basic-auth-password = ${?MAILJET_AUTH_PASSWORD}

    templates {
      from = "emailing@make.org"
      from-name = "make.org"
      front-url = "http://localhost:9009"
      vff-front-url = "http://localhost:9009"

      registration {
        template-id = "225362"
        enabled = true
        custom-campaign = "account"
        monitoring-category = "account"
        vff {
          template-id = "228778"
        }
      }

      welcome {
        template-id = "235799"
        enabled = true
        custom-campaign = "welcome"
        monitoring-category = "welcome"
        vff {
          template-id = "239520"
        }
      }

      resend-validation-link {
        template-id = "225375"
        enabled = true
        custom-campaign = "account"
        monitoring-category = "account"
      }

      forgotten-password {
        template-id = "225361"
        enabled = true
        custom-campaign = "account"
        monitoring-category = "account"
      }

      proposal-refused {
        template-id = "225359"
        enabled = true
        custom-campaign = "moderation"
        monitoring-category = "moderation"
      }

      proposal-accepted {
        template-id = "225358"
        enabled = true
        custom-campaign = "moderation"
        monitoring-category = "moderation"
      }
    }
  }

  authentication {
    default-client-id = "0cdd82cb-5cc0-4875-bb54-5c3709449429"
    default-client-id = ${?DEFAULT_CLIENT_ID}
    default-client-secret = "f4f7076e-6337-41d5-b000-3726ead0ae41"
    default-client-secret = ${?DEFAULT_CLIENT_SECRET}
  }

  passivate-timeout = "2 minutes"

  cookie-session {
    lifetime = "20 minutes"
    lifetime = ${?SESSION_COOKIE_LIFETIME}
    is-secure = false
    is-secure = ${?SESSION_COOKIE_IS_SECURE}
  }

  oauth {
    access-token-lifetime = 1800
    access-token-lifetime = ${?ACCESS_TOKEN_LIFETIME}
    refresh-token-lifetime = 14400
    refresh-token-lifetime = ${?REFRESH_TOKEN_LIFETIME}
  }

  duplicate-detector {
    max-results = 25
    max-results = ${?DUPLICATE_DETECTOR_MAX_RESULTS}
  }
}
